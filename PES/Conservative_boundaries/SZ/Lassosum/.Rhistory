library(data.table)
library(dplyr)
library(rcompanion)
library(ggplot2)
library(RColorBrewer)
All_SZ_scores <- fread("~/Desktop/SZ_PES_mtCOJO_norm/PES/ASRB_removed_lassosum_SZ_UKBB_TRAIN/All_SZ_penalised_PES_combined_lassosum_ASRB_removed.txt", header = T, sep = " ")
Colnames_all_SZ_scores <- make.unique(names(All_SZ_scores))
colnames(All_SZ_scores) <- Colnames_all_SZ_scores
SZ_pheno <- fread("~/Desktop/SZ_PES_mtCOJO_norm/PES/UKBB_phenotypes/SZ_phenotypes/SZ_UKBB_pheno.txt", header = T)
SZ_pheno <- fread("~/Desktop/SZ_PES_mtCOJO_norm/UKBB_phenotypes/SZ_phenotypes/SZ_UKBB_pheno.txt", header = T)
SZ_cov <- fread("~/Desktop/SZ_PES_mtCOJO_norm/UKBB_phenotypes/SZ_phenotypes/Covariates_SZ_UKBB.txt", header = T)
SZ_merged <- Reduce(function(dtf1, dtf2) merge(dtf1, dtf2, by = "IID"),
list(All_SZ_scores, SZ_pheno, SZ_cov))
SZ_merged$Batch <- as.factor(SZ_merged$Batch)
SZ_merged[,c(5, 10, 15, 20, 25, 30)] <- lapply(SZ_merged[,c(5, 10, 15, 20, 25, 30)], function(x) c(scale(x)))
Biochem <- fread("~/Desktop/SZ_PES_mtCOJO_norm/UKBB_phenotypes/UKBB_biochemical_pheWAS_IDs/Meausred_biochemical_data_UKBB.txt", header = T)
Biochem <- Biochem %>% select(f.eid, f.30710.0.0)
Biochem <- rename(Biochem, "f.eid"="IID", "f.30710.0.0"="CRP")
Biochem <- rename(Biochem, "IID"="f.eid", "CRP"="f.30710.0.0")
SZ_merged_CRP <- merge(Biochem, SZ_merged, by="IID")
SZ_merged_CRP$Ln_CRP <- log(SZ_merged_CRP$CRP)
plot(SZ_merged_CRP$CRP)
histo(SZ_merged$CRP)
histogram(SZ_merged$CRP)
hist(SZ_merged$CRP)
hist(as.numeric(SZ_merged$CRP))
rm(SZ_merged_CRP)
SZ_merged_CRP <- merge(Biochem, SZ_merged, by="IID")
SZ_merged_CRP <- SZ_merged_CRP %>% filter(!is.na(CRP))
SZ_merged_CRP$Ln_CRP <- log(SZ_merged_CRP$CRP)
hist(SZ_merged$CRP)
str(SZ_merged)
str(SZ_merged_CRP)
str(SZ_merged_CRP$CRP)
mean(SZ_merged_CRP$CRP)
hist(SZ_merged_CRP$CRP)
hist(SZ_merged_CRP$Ln_CRP)
table(SZ_merged_CRP$SZ)
SZ_CRP_obs_est <- glm(SZ ~ Sex*Age + Sex*I(Age^2) + CRP, family = "binomial",
data = SZ_merged_CRP)
summary(SZ_CRP_obs_est)
SZ_CRP_obs_est <- glm(SZ ~CRP, family = "binomial",
data = SZ_merged_CRP)
summary(SZ_CRP_obs_est)
SZ_CRP_obs_est <- glm(SZ ~ Sex*Age + Sex*I(Age^2) + CRP, family = "binomial",
data = SZ_merged_CRP)
SZ_Ln_CRP_obs_est <- glm(SZ ~ Sex*Age + Sex*I(Age^2) + Ln_CRP, family = "binomial",
data = SZ_merged_CRP)
summary(SZ_Ln_CRP_obs_est)
exp(0.47)
SZ_Ln_CRP_PRS <- glm(SZ ~ Sex*Age + Sex*I(Age^2) + Ln_CRP*PRS + PRS*Sex + PRS*Age + PRS*I(Age^2), family = "binomial",
data = SZ_merged_CRP)
str(SZ_merged_CRP)
All_SZ_scores <- fread("~/Desktop/SZ_PES_mtCOJO_norm/PES/Lassosum_SZ_UKBB/All_SZ_PES_PRS_validation_UKBB_PES_PRS.txt", header = T, sep = " ")
Colnames_all_SZ_scores <- make.unique(names(All_SZ_scores))
colnames(All_SZ_scores) <- Colnames_all_SZ_scores
SZ_pheno <- fread("~/Desktop/SZ_PES_mtCOJO_norm/UKBB_phenotypes/SZ_phenotypes/SZ_UKBB_pheno.txt", header = T)
SZ_cov <- fread("~/Desktop/SZ_PES_mtCOJO_norm/UKBB_phenotypes/SZ_phenotypes/Covariates_SZ_UKBB.txt", header = T)
SZ_merged <- Reduce(function(dtf1, dtf2) merge(dtf1, dtf2, by = "IID"),
list(All_SZ_scores, SZ_pheno, SZ_cov))
SZ_merged$Batch <- as.factor(SZ_merged$Batch)
SZ_merged[,c(5, 10, 15, 20, 25, 30)] <- lapply(SZ_merged[,c(5, 10, 15, 20, 25, 30)], function(x) c(scale(x)))
Biochem <- fread("~/Desktop/SZ_PES_mtCOJO_norm/UKBB_phenotypes/UKBB_biochemical_pheWAS_IDs/Meausred_biochemical_data_UKBB.txt", header = T)
Biochem <- Biochem %>% select(f.eid, f.30710.0.0)
Biochem <- rename(Biochem, "IID"="f.eid", "CRP"="f.30710.0.0")
SZ_merged_CRP <- merge(Biochem, SZ_merged, by="IID")
SZ_merged_CRP <- SZ_merged_CRP %>% filter(!is.na(CRP))
SZ_merged_CRP$Ln_CRP <- log(SZ_merged_CRP$CRP)
SZ_CRP_obs_est <- glm(SZ ~ Sex*Age + Sex*I(Age^2) + CRP, family = "binomial",
data = SZ_merged_CRP)
SZ_Ln_CRP_obs_est <- glm(SZ ~ Sex*Age + Sex*I(Age^2) + Ln_CRP, family = "binomial",
data = SZ_merged_CRP)
SZ_Ln_CRP_PRS <- glm(SZ ~ Sex*Age + Sex*I(Age^2) + Ln_CRP*PRS + PRS*Sex + PRS*Age + PRS*I(Age^2), family = "binomial",
data = SZ_merged_CRP)
summary(SZ_Ln_CRP_PRS)
SZ_Ln_CRP_PRS <- glm(SZ ~ PRS, family = "binomial",
data = SZ_merged_CRP)
summary(SZ_Ln_CRP_PRS)
SZ_Ln_CRP_PRS <- glm(SZ ~ Sex*Age + Sex*I(Age^2) + Ln_CRP + PRS, family = "binomial",
data = SZ_merged_CRP)
summary(SZ_Ln_CRP_PRS)
SZ_Ln_CRP_PRS <- glm(SZ ~ Sex*Age + Sex*I(Age^2) + Ln_CRP*PRS, family = "binomial",
data = SZ_merged_CRP)
summary(SZ_Ln_CRP_PRS)
SZ_Ln_CRP_PRS <- glm(SZ ~ Sex*Age + Sex*I(Age^2) + Ln_CRP*PRS + PC1 + PC2 + PC3 +
PC4 + PC5 + PC6 + PC7 + PC8 + PC9 + PC10, family = "binomial",
data = SZ_merged_CRP)
summary(SZ_Ln_CRP_PRS)
PRS_CRP_corr <- lm(Ln_CRP ~ PRS + Sex*Age + Sex*I(Age^2) + PC1 + PC2 + PC3 +
PC4 + PC5 + PC6 + PC7 + PC8 + PC9 + PC10, data = SZ_merged_CRP)
summary(PRS_CRP_corr)
library(vioplot)
install.packages("vioplot")
Simple_PRS_CRP_corr <- lm(Ln_CRP ~ PRS, data = SZ_merged_CRP)
CRP_resid <- as.data.frame(Simple_PRS_CRP_corr$residuals)
colnames(CRP_residuals)[1] <- "CRP_residuals"
colnames(CRP_resid)[1] <- "CRP_residuals"
SZ_merged_CRP$CRP_PRS_resid <- as.numeric(scaleCRP_resid$CRP_residuals))
SZ_merged_CRP$CRP_PRS_resid <- as.numeric(scale(CRP_resid$CRP_residuals))
SZ_Ln_CRP_PRS <- glm(SZ ~ Sex*Age + Sex*I(Age^2) + CRP_PRS_resid + PC1 + PC2 + PC3 +
PC4 + PC5 + PC6 + PC7 + PC8 + PC9 + PC10, family = "binomial",
data = SZ_merged_CRP)
summary(SZ_Ln_CRP_PRS)
SZ_Ln_CRP_PRS_resid <- glm(SZ ~ Sex*Age + Sex*I(Age^2) + CRP_PRS_resid + PC1 + PC2 + PC3 +
PC4 + PC5 + PC6 + PC7 + PC8 + PC9 + PC10, family = "binomial",
data = SZ_merged_CRP)
SZ_merged_CRP %>%
ggplot(aes(SZ, Ln_CRP, fill = SZ)) +
geom_hline(yintercept=0, color=textcolor, size=1) +
geom_split_violin(color=textcolor, trim=FALSE, alpha = 0.5) +
geom_pointrange(
data = summary_data,
aes(sex, mean, ymin=min, ymax=max),
color = textcolor,
shape = 20, # 95,
position = position_dodge(width = 0.25)
)
remotes::install_github("Rundmus/Useful4me-R_package")
library(Useful2me)
geom_split_violin(mapping = aes(x = SZ, y = Ln_CRP), data = SZ_merged_CRP)
VIP <-geom_split_violin(mapping = aes(x = SZ, y = Ln_CRP), data = SZ_merged_CRP)
VIP
geom_split_violin(mapping SZ ~ Ln_CRP, data = SZ_merged_CRP)
geom_split_violin(mapping = SZ ~ Ln_CRP, data = SZ_merged_CRP)
geom_split_violin(mapping = aes(SZ ~ Ln_CRP), data = SZ_merged_CRP)
geom_split_violin(mapping = aes(x = SZ, y = Ln_CRP), data = SZ_merged_CRP)
geom_split_violin(mapping = aes(x = SZ, y = Ln_CRP), data = SZ_merged_CRP,
draw_quantiles = T)
Boxplot <- melt(SZ_merged_CRP,measure.vars=c('Ln_CRP','CRP_PRS_resid'), id.vars='SZ')
Boxplot$SZ <- ifelse(Boxplot$SZ == 1, "SZ", "HC")
ggplot(Boxplot) +
geom_boxplot(aes(x=SZ, y=value, fill=variable)) +
theme_bw() +
xlab("Phenotype") +
ylab("Score") +
labs(fill = "Score name") +
theme(legend.position = "bottom") +
geom_hline(yintercept = 0, linetype = "longdash")
ggplot(Boxplot) +
geom_boxplot(aes(x=SZ, y=value, fill=SZ)) +
theme_bw() +
xlab("Phenotype") +
ylab("Score") +
labs(fill = "Score name") +
theme(legend.position = "bottom") +
geom_hline(yintercept = 0, linetype = "longdash")
ggplot(Boxplot) +
geom_boxplot(aes(x=SZ, y=value, fill=variable)) +
theme_bw() +
xlab("Phenotype") +
ylab("Score") +
labs(fill = "Score name") +
theme(legend.position = "bottom") +
geom_hline(yintercept = 0, linetype = "longdash")
ggplot(Boxplot) +
geom_boxplot(aes(x=SZ, y=value, fill=variable)) +
theme_bw() +
xlab("Phenotype") +
ylab("Score") +
labs(fill = "Score name") +
theme(legend.position = "side") +
geom_hline(yintercept = 0, linetype = "longdash")
ggplot(Boxplot) +
geom_boxplot(aes(x=SZ, y=value, fill=variable)) +
theme_bw() +
xlab("Phenotype") +
ylab("Score") +
labs(fill = "Score name") +
theme(legend.position = "right") +
geom_hline(yintercept = 0, linetype = "longdash")
ggplot(Boxplot) +
geom_boxplot(aes(x=SZ, y=value, fill=variable)) +
theme_bw() +
xlab("Phenotype") +
ylab("Score") +
labs(fill = "Score name") +
theme(legend.position = "bottom") +
geom_hline(yintercept = 0, linetype = "longdash")
ggplot(Boxplot) +
geom_boxplot(aes(x=SZ, y=variable, fill=variable)) +
theme_bw() +
xlab("Phenotype") +
ylab("Score") +
labs(fill = "Score name") +
theme(legend.position = "bottom") +
geom_hline(yintercept = 0, linetype = "longdash")
ggplot(Boxplot) +
geom_boxplot(aes(x=variable, y=value, fill=SZ)) +
theme_bw() +
xlab("Phenotype") +
ylab("Score") +
labs(fill = "Score name") +
theme(legend.position = "bottom") +
geom_hline(yintercept = 0, linetype = "longdash")
ggplot(Boxplot) +
geom_boxplot(aes(x=variable, y=value, fill=SZ)) +
theme_bw() +
xlab("Phenotype") +
ylab("Score") +
labs(fill = "Phenotype") +
theme(legend.position = "bottom") +
geom_hline(yintercept = 0, linetype = "longdash")
str(Boxplot)
CRP_plot_input <- rename(SZ_merged_CRP, "ln transformed CRP" = "Ln_CRP",
"SZ PRS residualised CRP"="CRP_PRS_resid")
CRP_plot_input <- rename(SZ_merged_CRP, "CRP ln(mg/L)" = "Ln_CRP",
"SZ PRS residualised CRP"="CRP_PRS_resid")
CRP_plot_input <- rename(SZ_merged_CRP, "CRP ln(mg/L)" = "Ln_CRP",
"SZ PRS residualised CRP (SD)"="CRP_PRS_resid")
Boxplot <- melt(CRP_plot_input,measure.vars=c('SZ PRS residualised CRP (SD)','CRP ln(mg/L)'), id.vars='SZ')
Boxplot$SZ <- ifelse(Boxplot$SZ == 1, "SZ", "HC")
ggplot(Boxplot) +
geom_boxplot(aes(x=variable, y=value, fill=SZ)) +
theme_bw() +
xlab("Phenotype") +
ylab("Score") +
labs(fill = "Phenotype") +
theme(legend.position = "bottom") +
geom_hline(yintercept = 0, linetype = "longdash")
str(Boxplot)
Boxplot <- melt(CRP_plot_input,measure.vars=c('SZ PRS residualised CRP (SD)','CRP ln(mg/L)', 'Age', "Sex"), id.vars='SZ')
str(CRP_plot_input)
Boxplot <- melt(CRP_plot_input,measure.vars=c('SZ PRS residualised CRP (SD)','CRP ln(mg/L)', 'Age', 'Sex'), id.vars='SZ')
CRP_plot_input <- rename(SZ_merged_CRP, "CRP ln(mg/L)" = "Ln_CRP",
"SZ PRS residualised CRP (SD)"="CRP_PRS_resid")
Boxplot <- melt(CRP_plot_input,measure.vars=c('SZ PRS residualised CRP (SD)','CRP ln(mg/L)', 'Age', 'Sex'), id.vars='SZ')
Boxplot
ggplot(Boxplot) +
geom_boxplot(aes(x=variable, y=value, fill=SZ)) +
theme_bw() +
xlab("Phenotype") +
ylab("Score") +
labs(fill = "Phenotype") +
theme(legend.position = "bottom") +
geom_hline(yintercept = 0, linetype = "longdash")
CRP_plot_input <- rename(SZ_merged_CRP, "CRP ln(mg/L)" = "Ln_CRP",
"SZ PRS residualised CRP (SD)"="CRP_PRS_resid")
Sex_Boxplot <- melt(CRP_plot_input,measure.vars=c('SZ PRS residualised CRP (SD)','CRP ln(mg/L)'), id.vars='SZ', 'Sex')
Boxplot$SZ <- ifelse(Boxplot$SZ == 1, "SZ", "HC")
ggplot(Boxplot) +
geom_boxplot(aes(x=variable, y=value, fill=Sex)) +
theme_bw() +
xlab("Phenotype") +
ylab("Score") +
labs(fill = "Phenotype") +
theme(legend.position = "bottom") +
geom_hline(yintercept = 0, linetype = "longdash")
ggplot(Sex_Boxplot) +
geom_boxplot(aes(x=variable, y=value, fill=Sex)) +
theme_bw() +
xlab("Phenotype") +
ylab("Score") +
labs(fill = "Phenotype") +
theme(legend.position = "bottom") +
geom_hline(yintercept = 0, linetype = "longdash")
Sex_Boxplot <- melt(CRP_plot_input,measure.vars=c('SZ PRS residualised CRP (SD)','CRP ln(mg/L)'), id.vars='SZ', 'Sex')
Sex_Boxplot$SZ <- ifelse(Sex_Boxplot$SZ == 1, "SZ", "HC")
ggplot(Sex_Boxplot) +
geom_boxplot(aes(x=variable, y=value, fill=Sex)) +
theme_bw() +
xlab("Phenotype") +
ylab("Score") +
labs(fill = "Phenotype") +
theme(legend.position = "bottom") +
geom_hline(yintercept = 0, linetype = "longdash")
str(Sex_Boxplot)
ggplot(Sex_Boxplot) +
geom_boxplot(aes(x=SZ, y=value, fill=Sex)) +
theme_bw() +
xlab("Phenotype") +
ylab("Score") +
labs(fill = "Phenotype") +
theme(legend.position = "bottom") +
geom_hline(yintercept = 0, linetype = "longdash")
ggplot(Sex_Boxplot) +
geom_boxplot(aes(x=SZ, y=value, fill=Sex)) +
theme_bw() +
xlab("Phenotype") +
ylab("Score") +
labs(fill = "Phenotype") +
theme(legend.position = "bottom") +
geom_hline(yintercept = 0, linetype = "longdash")
ggplot(Sex_Boxplot) +
geom_boxplot(aes(x=Sex, y=value, fill=SZ)) +
theme_bw() +
xlab("Phenotype") +
ylab("Score") +
labs(fill = "Phenotype") +
theme(legend.position = "bottom") +
geom_hline(yintercept = 0, linetype = "longdash")
head(Sex_Boxplot)
Sex_Boxplot <- melt(CRP_plot_input,measure.vars=c('SZ PRS residualised CRP (SD)','CRP ln(mg/L)'), id.vars=c('SZ', 'Sex'))
Sex_Boxplot$SZ <- ifelse(Sex_Boxplot$SZ == 1, "SZ", "HC")
ggplot(Sex_Boxplot) +
geom_boxplot(aes(x=Sex, y=value, fill=SZ)) +
theme_bw() +
xlab("Phenotype") +
ylab("Score") +
labs(fill = "Phenotype") +
theme(legend.position = "bottom") +
geom_hline(yintercept = 0, linetype = "longdash")
ggplot(Sex_Boxplot) +
geom_boxplot(aes(x=SZ, y=value, fill=Sex)) +
theme_bw() +
xlab("Phenotype") +
ylab("Score") +
labs(fill = "Phenotype") +
theme(legend.position = "bottom") +
geom_hline(yintercept = 0, linetype = "longdash")
head(Sex_Boxplot)
ggplot(Sex_Boxplot) +
geom_boxplot(aes(x=variable, y=value, fill=Sex)) +
theme_bw() +
xlab("Phenotype") +
ylab("Score") +
labs(fill = "Phenotype") +
theme(legend.position = "bottom") +
geom_hline(yintercept = 0, linetype = "longdash")
ggplot(Sex_Boxplot) +
geom_boxplot(aes(x=variable, y=value, fill=SZ)) +
theme_bw() +
xlab("Phenotype") +
ylab("Score") +
labs(fill = "Phenotype") +
theme(legend.position = "bottom") +
geom_hline(yintercept = 0, linetype = "longdash")
Sex_Boxplot <- melt(CRP_plot_input,measure.vars=c('SZ PRS residualised CRP (SD)','CRP ln(mg/L)'), id.vars=c('Sex'))
ggplot(Sex_Boxplot) +
geom_boxplot(aes(x=, y=value, fill=SZ)) +
theme_bw() +
xlab("Phenotype") +
ylab("Score") +
labs(fill = "Phenotype") +
theme(legend.position = "bottom") +
geom_hline(yintercept = 0, linetype = "longdash")
ggplot(Sex_Boxplot) +
geom_boxplot(aes(x=Sex, y=value, fill=Sex)) +
theme_bw() +
xlab("Phenotype") +
ylab("Score") +
labs(fill = "Phenotype") +
theme(legend.position = "bottom") +
geom_hline(yintercept = 0, linetype = "longdash")
ggplot(Sex_Boxplot) +
geom_boxplot(aes(x=variable, y=value, fill=Sex)) +
theme_bw() +
xlab("Phenotype") +
ylab("Score") +
labs(fill = "Phenotype") +
theme(legend.position = "bottom") +
geom_hline(yintercept = 0, linetype = "longdash")
SZ_merged_CRP$SZ <- ifelse(SZ_merged_CRP$SZ == 1, "PROB", "CTR")
SZ_merged_CRP <- SZ_merged_CRP %>% select(IID, SZ, Age, Sex, Ln_CRP)
write.csv(SZ_merged_CRP, file="~/Desktop/CRP_UKBB_project_WR_DK/GP_SZ_UKBB_cohort_input.csv",
row.names = F, quote = F)
